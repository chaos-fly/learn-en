<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <script type='text/javascript' src='js/jquery-1.7.2.min.js'></script>
</head>

<body>
    <div>
        <audio id="music"> </audio>
    </div>

    <div id="pics">
    </div>
</body>

<script>
    $('#pics').on("click", "img", function() {
        var tname = $(this).attr("tname");
        var typ = $(this).attr("typ");
        var audios = metaData[typ][tname];
        var r = Math.ceil(Math.random() * 10);
        var fileName = audios[r % audios.length];
        //var fileName = audios[1];
        var target = $("#music")[0];
        target.src = fileName;
        target.play();
    });

    // 重新加载图片
    function reloadPictures() {
        var keys = new Array();
        if (metaData[kTypes]) {
            keys = Object.keys(metaData[kTypes]).map(function(v, idx) {
                return '<img src="img/' + this + "/" + v + '.jpg" typ="' + this + '" tname="' + v + '"/>';
            }, kTypes);
        } else {
            var allType = Object.keys(metaData);
            for (var i=0; i < allType.length; ++i) {
                var tp = allType[i];
                var tmp = Object.keys(metaData[tp]).map(function(v, idx) {
                    return '<img src="img/' + this + "/" + v + '.jpg" typ="' + this + '" tname="' + v + '"/>';
                }, tp);
                keys = keys.concat(tmp);
            }
        }
        keys.push('<img src="img/fruit/song.jpg typ="fruit" tname="song"/>');
        keys.shuffle();
        for (var i = 0; i < keys.length; ++i) {
            $("#pics").append(keys[i]);
        }
    }

	$(document).ready(function() {
        var args = document.location.search.replace('?', '').split('&');
        for (var i = 0; i < args.length; ++i) {
            var kv = args[i].split('=');
            if (kv[0] == 'type') {
                kTypes = kv[1];
            }
        }
        reloadPictures();
	});

    // 随机重排
    if (!Array.prototype.shuffle) {
        Array.prototype.shuffle = function() {
            for (var j, x, i = this.length; i; 
                    j = parseInt(Math.random() * i), x = this[--i], this[i] = this[j], this[j] = x)
                ;
            return this;
        }
    }

    var kTypes = "all";
    var metaData = 
    {
		"fruit": {
            "song" : [
                "mp3/fruit/song_all_green.mp3"
            ],
			"flower": [
				"mp3/fruit/flower.mp3"
			],
			"lemon": [
				"mp3/fruit/lemon.mp3"
			],
			"leaves": [
				"mp3/fruit/leaves.mp3"
			],
			"tree": [
				"mp3/fruit/tree.mp3"
			],
			"grapes": [
				"mp3/fruit/grapes.mp3"
			],
			"grass": [
				"mp3/fruit/grass.mp3"
			]
		},
        "clothes": {
            "shoes": [
                "mp3/clothes/shoes.mp3",
                "mp3/clothes/shoes_i_want.mp3",
                "mp3/clothes/shoes_they_are.mp3"
            ],
            "hat": [
                "mp3/clothes/hat.mp3",
                "mp3/clothes/hat_i_want.mp3",
                "mp3/clothes/hat_is.mp3"
            ],
            "sweater": [
                "mp3/clothes/sweater.mp3",
                "mp3/clothes/sweater_i_want.mp3",
                "mp3/clothes/sweater_is.mp3"
            ],
            "socks": [
                "mp3/clothes/socks.mp3",
                "mp3/clothes/socks_i_want.mp3",
                "mp3/clothes/socks_they_are.mp3"
            ],
            "t-shirt": [
                "mp3/clothes/t-shirt.mp3",
                "mp3/clothes/t-shirt_i_want.mp3",
                "mp3/clothes/t-shirt_is.mp3"
            ],
            "skirt": [
                "mp3/clothes/skirt.mp3",
                "mp3/clothes/skirt_i_want.mp3",
                "mp3/clothes/skirt_is.mp3"
            ],
            "pants": [
                "mp3/clothes/pants.mp3",
                "mp3/clothes/pants_i_want.mp3",
                "mp3/clothes/pants_they_are.mp3"
            ]
        }
    };

</script>
</html>

